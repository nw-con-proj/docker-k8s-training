# Lab Services の Windows Serverの初期セットアップ方法  

初期セットアップとして、新しいラボの作成からGUIの日本語化とタイムゾーンの設定を手動で行います。  

## 新しいラボの作成  
- AzureのLab Servicesを作成し、**ラボの作成**を実行します。  
  ![](img/2021-06-24_08h22_25.png)  

- **新しいラボ**をクリックし、パラメータを設定します。

|設定名|値|
|:-|:-|
|ラボに名前をつけます|任意のラボの名前|
|使用する仮想マシンのイメージ|Windows Server 2019 Datacenter|
|必要な仮想マシンサイズ|大(入れ子になった仮想化)|  

  ![](img/2021-06-24_07h56_48.png)  

- ユーザー名とパスワードを指定します。 

|設定名|値|
|:-|:-|
|ユーザー名|labuser|
|パスワード|任意の値|  

  ![](img/2021-06-24_07h57_28.png)  

- ラボポリシーを指定します。ここはデフォルトのまま進みます。  
  ![](img/2021-06-24_07h57_34.png)  

- ラボが作成されるまで待ちます。  
  ![](img/2021-06-24_07h57_58.png)


## テンプレートの作成  
Labの仮想マシンのテンプレートを作成します。ここで設定した仮想マシンをテンプレートとしてLab利用者が利用できるようになります。  
ここではベースのセットアップだけ行い、そのほかの設定は各環境にあわせた[Hyper-V用の設定](hyper-v/prepare/RREADME.md)か[VirtualBox用の設定](virtualbox/prepare/README.md)を実施してください。  

### テンプレートへの接続  

- **テンプレートの開始** を実行します。 ここでも数分時間がかります。  
  ![](img/2021-06-24_08h36_53.png)  

- テンプレートが開始されたら **テンプレートに接続する**をクリックします。 RDPのショートカットがダウンロードされるので実行します。  
  ![](img/2021-06-24_08h40_46.png) 

- 警告が表示されますが、**接続**をクリックし、パスワードを入力して接続します。パスワードはラボ作成時に指定したパスワードです。    
  ![](img/2021-06-24_08h41_12.png) ![](img/2021-06-24_08h41_38.png)  
  証明書の警告も気にせず接続します。  
  ![](img/2021-06-24_08h43_48.png)  

- リモートデスクトップで接続できます。  
  ![](img/2021-06-24_08h45_33.png)  

### 言語設定  

- *Windowsアイコン(スタート) -> 歯車アイコン(Setting)* と移動し、**Time & Language** をクリックします。  
  ![](img/2021-06-24_08h46_25.png)  

- *Time zone* を **(UTC+09:00) Osaka,Sapporo,Tokyo** に指定します。  
  ![](img/2021-06-24_08h48_28.png)  

- *Language* に移動します。  
  **Add a Language** をクリックし、**日本語**を選択、Nextをクリックします。  
  ![](img/2021-06-24_08h51_15.png)  

- *Install Language features* はデフォルトのまま、Install をクリックします。  
  ![](img/2021-06-24_08h51_39.png)  

- インストールが開始されます。少し時間がかかりますので待ちます。  
  ![](img/2021-06-24_08h53_56.png)  

- インストールが完了すると *Will be display language after next sign-in* を表示されますので、一度サインアウトします。
  このときRDPが切断されます。  
  ![](img/2021-06-24_09h03_27.png)

- 再度、ダウンロードしたRDPのショートカットを実行し接続します。
  日本語で表示され、時刻も日本時間となっていることを確認します。  
  ![](img/2021-06-24_09h05_40.png)  

### 利用環境に合わせた設定  
VirtualBoxとHyper-Vに合わせた設定を行います。  
Azure Lab Servicesを利用する場合、VirtualBoxでは正常に動作しないため、Hyper-V版を利用してください。  


## テンプレートの停止と公開  
すべてのセットアップが完了したら、テンプレートの仮想マシンをシャットダウンし、Azure Lab ServiceのWebUIから **テンプレートの停止** を実行します。  
テンプレートの停止後、**公開** することでラボ利用者がこのテンプレートを利用できるようになります。  




